<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Usuários</title>
    <link rel="stylesheet" href="../css/style_admin.css">
    <link rel="shortcut icon" href="../assets/imgs/logoEvora.svg" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-solid-rounded/css/uicons-solid-rounded.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="../js/login-cadas.js"></script>
    <script src="../js/dash.js"></script>
</head>


<body onload="puxarNomeUsuario(), listarUsuariosInstituicao()">
    <header class="header_info_usuario">
        <img src="../assets/imgs/logo-nome.svg" alt="" class="img_logo">

        <a href="../index.html" class="botao-sair-mobile">
            <i class="fi fi-sr-exit"></i>
        </a>
    </header>
    <main>
        <aside>
            <section class="section_aside">
                <ul>
                    <li><a href="./dashHomeAdmin.html"><i class="fi fi-sr-home"></i>Dashboard</a></li>
                    <li><a href="./dashCursoAdmin.html"><i class="fi fi-sr-users-alt"></i>Cursos</a></li>
                    <li><a href="./dashAlunosAdmin.html"><i class="fi fi-sr-user"></i>Alunos</a></li>
                    <li><a href="./dashConfAdmin.html"><i class="fi fi-sr-settings"></i>Configurações</a></li>
                    <li class="active"><a href="#"><i class="fi fi-sr-user-add"></i>Criar Usuário</a></li>
                    <li><a href="./dash_admin_cursos.html"><i class="fi fi-sr-books-medical"></i>Criar Curso</a></li>
                </ul>

                <a href="../index.html" class="botao-sair">
                    <i class="fi fi-sr-exit"></i> SAIR
                </a>
            </section>
        </aside>


        <section class="section_dash">
            <main class="main_dash">
                <header class="header_kpis">

                    <section class="kpi">

                        <div class="kpi_header">
                            <div class="div_titulo_kpi" id="div_situacao">
                                <p class="p_titulo_kpi">TOTAL DE USUÁRIOS CRIADOS</p>
                                <h1 id="h1_situacao" class="qtd_usuarios">234</h1>
                            </div>

                        </div>
                        <div>

                            <div class="kpi_footer">

                                <p class="p_titulo_kpi"><span class="qtd_professores">34</span> com tipo de<strong>
                                        Professor</strong></p>
                                <p class="p_titulo_kpi"><span class="qtd_alunos">200</span> com tipo de <strong>
                                        Aluno</strong></p>

                            </div>

                        </div>



                    </section>

                    <section class="kpi">
                        <div class="kpi_header" id="kpi_situacao">
                            <div class="div_titulo_kpi" id="div_situacao">
                                <p class="p_titulo_kpi">SITUAÇÃO ATUAL</p>
                                <h1 id="h1_situacao"><span class="qtd_bloqueados"></span> BLOQUEADOS</h1>
                            </div>
                            <div class="div_comparativo">

                                <p class="p_titulo_kpi"><strong><span class="qtd_liberados">239</span>
                                        Liberados</strong></p>
                                <p class="p_titulo_kpi"><strong><span class="qtd_bloqueados">0</span>
                                        Bloqueados</strong></p>

                            </div>
                        </div>
                        <div class="div_progress_bar">
                            <div class="progress_bar" id="progress_bar_situacao">
                                <progress id="progress_bar" value="32" max="100"> 32% </progress>
                            </div>
                        </div>
                    </section>
                </header>

                <section class="section_main">
                    <header class="header_usuarios">

                        <input type="search" placeholder="Digite nome ou ID para procurar pelo usuário..."
                            class="input_pesquisa" onkeyup="filtrarUsuarios()" id="barra_pesquisa">
                        <div class="div_criar_usuario" id="btnAbrirDialog"
                            onclick="listarInstituicoes(), abrirModal('modal_criar_usuario')">
                            <p><strong>+ Criar Novo Usuário</strong></p>
                        </div>

                    </header>
                   

                    <main class="main_usuarios">
                        <table class="tabela">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>Tipo</th>
                                    <th>Turma</th>
                                    <th>Curso</th>
                                    <th>Situação</th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody class="corpo_tabela" id="corpo_tabela_usuarios">
                            </tbody>
                        </table>
                    </main>

                    <div id="paginacao_container" class="paginacao_container">
                    </div>

                    <!-- <main class="main_usuarios">
                        <table class="tabela">
                            <tbody class="corpo_tabela" id="corpo_tabela_usuarios">


                            </tbody>
                        </table>

                    </main> -->
                </section>
            </main>
        </section>
    </main>

    <dialog id="modal_criar_usuario" class="dialog_modal">
        <div class="div_header_modal">
            <div class="div_btn_usuario active" onclick="criarAluno('formulario_criar_usuario')" id="btn_criar_aluno">
                Novo Aluno</div>
            <div class="div_btn_usuario" onclick="criarProfessor('formulario_criar_usuario')" id="btn_criar_professor">
                Novo Professor</div>
        </div>
        <div class="div_main_modal" id="formulario_criar_usuario">
            <h3>Complete as informações do Novo Aluno:</h3>
            <form class="form_modal">

                <label>RA:</label>
                <input type="text" class="input_modal" id="input_ra_aluno" placeholder="Digite o RA do aluno">

                <label>Nome:</label>
                <input type="text" class="input_modal" id="input_nome_aluno" placeholder="Digite o nome do aluno">

                <label>Email:</label>
                <input type="text" class="input_modal" id="input_email_aluno" placeholder="Digite o email do aluno">

                <label>Turma:</label>
                <input list="lista_turmas_criar" type="text" id="input_turma_aluno" class="input_modal"
                    placeholder="Pesquise pela sua turma">
                <datalist id="lista_turmas_criar" class="turmas_datalist"></datalist>

            </form>

            <div class="div_footer">
                <div class="div_criar_usuario" onclick="enviarModal('modal_criar_usuario')">
                    <p><strong>Criar Novo Usuário</strong></p>
                </div>
                <p onclick="fecharModal('modal_criar_usuario')"><u>cancelar</u></p>
            </div>

        </div>
    </dialog>

    <dialog id="modal_editar_usuario" class="dialog_modal">
        <div class="div_main_modal">
            <div class="div_header_modal">
                <h3>Edite as informações do Usuário:</h3>
                <div class="div_status" id="div_status_editar" onclick="alternarStatusEdicao()"
                    style="cursor: pointer;">
                </div>
            </div>
            <form class="form_modal">

                <div class="div_dois_inputs">
                    <div class="div_input_menor">
                        <label for="ra" id="label_ra_re">RA:</label>
                        <input type="text" class="input_modal input_modal_ra" name="ra" placeholder="Digite o ID">
                    </div>

                    <div class="div_input_maior">
                        <label for="tipo_de_usuario">Tipo:</label>
                        <select class="select_tipo_de_usuario" id="tipo_de_usuario" name="tipo_de_usuario" disabled>
                            <option value="Aluno">Aluno</option>
                            <option value="Professor">Professor</option>
                        </select>
                    </div>
                </div>

                <div class="div_dois_inputs">
                    <div class="div_input_menor">
                        <label for="nome">Nome:</label>
                        <input type="text" class="input_modal" name="nome" placeholder="Digite o Nome">
                    </div>
                    <div class="div_input_maior">
                        <label for="email">Email:</label>
                        <input type="text" class="input_modal" name="email" placeholder="Digite o Email">
                    </div>
                </div>

                <div class="div_dois_inputs">
                    <div class="div_input_menor">
                        <label for="nome_turma">Turma:</label>
                        <input list="turma_editar_usuario" type="text" id="turma_editar" name="nome_turma"
                            placeholder="Pesquise pela turma" class="input_modal">
                        <datalist id="turma_editar_usuario" class="turmas_datalist"></datalist>
                    </div>

                    <div class="div_input_maior" id="div_input_disciplina_editar" style="display: none;">
                        <label for="nome_disciplina">Disciplina:</label>
                        <input list="lista_disciplinas" type="text" id="input_disciplina_prof" name="nome_disciplina"
                            placeholder="Qual matéria? (Ex: Banco de Dados)">
                        <datalist id="lista_disciplinas">
                        </datalist>
                    </div>
                </div>

                <div class="div_input">
                    <label for="nome_curso">Curso (Informativo):</label>
                    <input type="text" id="curso_editar" class="input_modal" disabled>
                </div>

            </form>

            <div class="div_footer">
                <div class="div_editar_usuario" id="btnEnviarDialog" onclick="enviarModal('modal_editar_usuario')">
                    <p><strong>Salvar</strong></p>
                </div>
                <p id="btnFecharDialog" onclick="fecharModal('modal_editar_usuario')"><u>cancelar</u></p>
            </div>
        </div>
    </dialog>

    <!-- 
    <dialog id="modal_editar_usuario" class="dialog_modal">

        <div class="div_main_modal">
            <div class="div_header_modal">
                <h3>Edite as informações do Usuário:</h3>
                <div class="div_status">
                    <div class="circulo_status_liberado">
                        <p>L</p>
                    </div>
                </div>
            </div>
            <form class="form_modal">

                <div class="div_dois_inputs">

                    <div class="div_input_menor">
                        <label for="ra" id="label_id_usuario">RA:</label>
                        <input type="text" class="input_modal, input_modal_ra" name="ra"
                            placeholder="Digite o RA do aluno">
                    </div>

                    <div class="div_input_maior">
                        <label for="tipo_de_usuario">Tipo:</label>
                        <select class="select_tipo_de_usuario" id="tipo_de_usuario" name="tipo_de_usuario">
                            <option value="Aluno">Aluno</option>
                            <option value="Professor">Professor</option>
                        </select>
                    </div>

                </div>

                <div class="div_dois_inputs">

                    <div class="div_input_menor">

                        <label for="ra">Nome:</label>
                        <input type="text" class="input_modal" name="nome" placeholder="Digite o Nome do aluno">
                    </div>
                    <div class="div_input_maior">
                        <label for="ra">Email:</label>
                        <input type="text" class="input_modal" name="email" placeholder="Digite o Email do aluno">

                    </div>

                </div>

                <div class="div_dois_inputs">

                    <div class="div_input_menor">
                        <label for="nome_turma">Turma:</label>
                        <input list="turma_editar_usuario" type="nome_turma" id="turma_editar" name="nome_turma"
                            placeholder="Pesquise pela sua turma" class="input_modal">
                        <datalist id="turma_editar_usuario" class="turmas_datalist">
                            <option value=""></option>
                        </datalist>
                    </div>


                    <div class="div_input_maior">
                        <label for="nome_instituicao">Instituição:</label>
                        <input list="instituicoes" type="nome_instituicao" id="instituicao" name="nome_instituicao"
                            placeholder="Pesquise pela sua instituicao" class="input_modal">
                        <datalist id="instituicoes">
                            <option value=""></option>
                        </datalist>
                    </div>


                </div>


                <div class="div_input">
                    <label for="nome_curso">Curso:</label>
                    <input list="cursos" type="nome_curso" id="curso" name="nome_curso"
                        placeholder="Pesquise pela sua curso" class="input_modal">
                    <datalist id="cursos">
                        <option value=""></option>
                    </datalist>
                </div>

            </form>

            <div class="div_footer">

                <div class="div_editar_usuario" id="btnEnviarDialog" onclick="enviarModal('modal_editar_usuario')">
                    <p><strong>Salvar</strong></p>
                </div>

                <p id="btnFecharDialog" onclick="fecharModal('modal_editar_usuario')"><u>cancelar</u></p>

            </div>

        </div>
    </dialog> -->

    <dialog id="modal_remover_usuario" class="dialog_modal">

        <div class="div_main_modal">

            <div class="div_info_excluir">
                <h1>Excluir cadastro</h1>
                <p>Tem certeza que deseja deletar esse cadastro? <br>Não é possível desfazer essa ação</p>
            </div>

            <div class="div_btn_remover_usuario" id="div_btn_remover_usuario">

                <div class="div_editar_usuario" onclick="fecharModal('modal_remover_usuario')">
                    <p><strong>Cancelar</strong></p>
                </div>

                <div class="div_editar_usuario" id="div_excluir_usuario" onclick="enviarModal('modal_remover_usuario')">
                    <p><strong>Excluir</strong></p>
                </div>
            </div>

        </div>


        </div>
    </dialog>
</body>

</html>

<script>

    function abrirModal(modalId) {
        const dialog = document.getElementById(modalId);

        if (modalId === 'modal_remover_usuario') {

            const idVisitante = sessionStorage.getItem('idVisitante');
            const tipoVisitante = sessionStorage.getItem('tipoVisitante');

            console.log(idVisitante, tipoVisitante)


        } else if (modalId === 'modal_editar_usuario') {

            // Carrega as listas
            listarCursos();
            listarTurmas();
            listarInstituicoes(); // Apenas para garantir, embora não tenha input
            listarDisciplinas();  // Importante para o professor

            // Recupera dados da sessão
            const nome = sessionStorage.getItem('nomeVisitante');
            const email = sessionStorage.getItem('emailVisitante');
            const tipo = sessionStorage.getItem('tipoVisitante');
            const turma = sessionStorage.getItem('turmaVisitante');
            const curso = sessionStorage.getItem('cursoVisitante');
            const instituicao = sessionStorage.getItem('instituicaoVisitante');
            const idUser = sessionStorage.getItem('idVisitante');
            const situacao = sessionStorage.getItem('situacaoVisitante');

            // Referências aos elementos do DOM
            const labelRaRe = document.getElementById('label_ra_re');
            const divDisciplina = document.getElementById('div_input_disciplina_editar');
            const divStatus = document.getElementById('div_status_editar');

            // Configuração visual baseada no Tipo
            if (tipo === 'Professor') {
                labelRaRe.innerHTML = 'RE:';
                divDisciplina.style.display = 'block'; // Mostra disciplina
            } else {
                labelRaRe.innerHTML = 'RA:';
                divDisciplina.style.display = 'none'; // Esconde disciplina
            }

            // Configuração do Status (Clicável)
            // Guardamos o estado atual num atributo data-status para facilitar a troca
            if (situacao === 'liberado') {
                divStatus.setAttribute('data-status', 'liberado');
                divStatus.innerHTML = `<div class="circulo_status_liberado"><p>L</p></div>`;
            } else {
                divStatus.setAttribute('data-status', 'bloqueado');
                divStatus.innerHTML = `<div class="circulo_status_bloqueado"><p>B</p></div>`;
            }

            // Preenche os Inputs
            if (dialog.querySelector('input[name="nome"]')) dialog.querySelector('input[name="nome"]').value = nome;
            if (dialog.querySelector('input[name="email"]')) dialog.querySelector('input[name="email"]').value = email;
            if (dialog.querySelector('select[name="tipo_de_usuario"]')) dialog.querySelector('select[name="tipo_de_usuario"]').value = tipo;
            if (dialog.querySelector('input[name="ra"]')) dialog.querySelector('input[name="ra"]').value = idUser;

            const inputTurma = dialog.querySelector('#turma_editar');
            if (inputTurma) inputTurma.value = turma;

            const inputCurso = document.getElementById('curso_editar');
            if (inputCurso) inputCurso.value = curso;

        } else if (modalId === 'modal_criar_usuario') {

            listarCursos();
            listarTurmas();
            listarInstituicoes();

            listarDisciplinas()

        }

        dialog.showModal();
    }

    function fecharModal(modalId) {
        const dialog = document.getElementById(modalId);

        sessionStorage.removeItem('nomeVisitante');
        sessionStorage.removeItem('emailVisitante');
        sessionStorage.removeItem('tipoVisitante');
        sessionStorage.removeItem('turmaVisitante');
        sessionStorage.removeItem('cursoVisitante');
        sessionStorage.removeItem('instituicaoVisitante');
        sessionStorage.removeItem('situacaoVisitante');
        sessionStorage.removeItem('idVisitante');

        dialog.close();
    }

    function enviarModal(modalId) {
        const dialog = document.getElementById(modalId);

        // Lógica para enviar os dados do modal pode ser adicionada aqui

        if (modalId === 'modal_criar_usuario') {

            const tipoAtual = sessionStorage.getItem('tipoVisitante');

            if (tipoAtual === 'Professor') {
                realizarCadastroProfessor();
            } else {

                realizarCadastroAluno();
            }

        } else if (modalId === 'modal_remover_usuario') {

            const idVisitante = sessionStorage.getItem('idVisitante');
            const tipoVisitante = sessionStorage.getItem('tipoVisitante');

            if (tipoVisitante === 'Aluno') {
                removerAluno(idVisitante);
            } else if (tipoVisitante === 'Professor') {
                removerUsuario(idVisitante);
            }

            sessionStorage.removeItem('nomeVisitante');
            sessionStorage.removeItem('emailVisitante');
            sessionStorage.removeItem('tipoVisitante');
            sessionStorage.removeItem('turmaVisitante');
            sessionStorage.removeItem('instituicaoVisitante');
            sessionStorage.removeItem('situacaoVisitante');
            sessionStorage.removeItem('idVisitante');

            fecharModal('modal_remover_usuario');

        } else if (modalId === 'modal_editar_usuario') {

            salvarEdicao();

        }

    }


    function alternarStatusEdicao() {
        const divStatus = document.getElementById('div_status_editar');
        const statusAtual = divStatus.getAttribute('data-status');

        if (statusAtual === 'liberado') {
            // Troca para bloqueado
            divStatus.setAttribute('data-status', 'bloqueado');
            divStatus.innerHTML = `<div class="circulo_status_bloqueado"><p>B</p></div>`;
        } else {
            // Troca para liberado
            divStatus.setAttribute('data-status', 'liberado');
            divStatus.innerHTML = `<div class="circulo_status_liberado"><p>L</p></div>`;
        }
    }



    function realizarCadastroProfessor() {
        const modal = document.getElementById('modal_criar_usuario');

        // Captura os inputs pelos IDs definidos na função criarProfessor
        const nome = document.getElementById('nome_prof').value;
        const email = document.getElementById('email_prof').value;
        const senha = document.getElementById('senha_prof').value;
        const turma = document.getElementById('input_turma_prof').value;
        const disciplina = document.getElementById('input_disciplina_prof').value;

        // Pega o ID da instituição da sessão do usuário logado
        const idInstituicao = sessionStorage.getItem('fkInstituicao');

        // Validação
        if (!nome || !email || !senha || !turma || !disciplina) {
            alert("Preencha todos os campos para cadastrar o professor!");
            return;
        }

        fetch("/usuarios/cadastrarProfessor", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nome: nome,
                email: email,
                senha: senha,
                turma: turma,
                disciplina: disciplina,
                idInstituicao: idInstituicao
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                alert("Professor cadastrado com sucesso!");
                listarUsuariosInstituicao(); // Atualiza a tabela
                fecharModal('modal_criar_usuario');
            } else {
                resposta.text().then(texto => {
                    alert("Erro ao cadastrar: " + texto);
                });
            }
        }).catch(function (erro) {
            console.error("Erro no fetch:", erro);
        });
    }

    function realizarCadastroAluno() {
        // Busca os elementos pelos IDs definidos na função criarAluno
        const inputRa = document.getElementById('input_ra_aluno');
        const inputNome = document.getElementById('input_nome_aluno');
        const inputEmail = document.getElementById('input_email_aluno');
        const inputTurma = document.getElementById('input_turma_aluno');

        // Se qualquer um for null, avisa no console e para (evita o erro que travava a tela)
        if (!inputRa || !inputNome || !inputEmail || !inputTurma) {
            console.error("Erro CRÍTICO: IDs do HTML não conferem com o Script. Verifique a função criarAluno.");
            alert("Erro interno: Campos não encontrados.");
            return;
        }

        const ra = inputRa.value;
        const nome = inputNome.value;
        const email = inputEmail.value;
        const turma = inputTurma.value;

        if (!ra || !nome || !turma || !email) {
            alert("Preencha todos os campos obrigatórios!");
            return;
        }

        fetch("/usuarios/cadastrarAluno", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ra, nome, email, turma })
        }).then(resposta => {
            if (resposta.ok) {
                alert("Aluno cadastrado com sucesso!");
                listarUsuariosInstituicao();
                fecharModal('modal_criar_usuario');
            } else {
                resposta.text().then(texto => alert("Erro ao cadastrar: " + texto));
            }
        }).catch(erro => console.error("Erro:", erro));
    }

    function salvarEdicao() {
        const id = sessionStorage.getItem('idVisitante');
        const tipo = sessionStorage.getItem('tipoVisitante');
        const modal = document.getElementById('modal_editar_usuario');

        // 1. Captura os valores dos inputs
        const nome = modal.querySelector('input[name="nome"]').value;
        const email = modal.querySelector('input[name="email"]').value;

        // --- CORREÇÃO AQUI ---
        // Estava pegando '#turma_editar_usuario' (que é a lista). 
        // O correto é '#turma_editar' (que é o input).
        const nomeTurma = modal.querySelector('#turma_editar').value;

        // 2. Captura a Disciplina (apenas se for Professor)
        let disciplina = "";
        if (tipo === 'Professor') {
            const inputDisc = modal.querySelector('#input_disciplina_prof'); // Verifique se o ID no HTML de editar está correto
            // No seu HTML de editar, o ID do input de disciplina está como 'input_disciplina_prof' (igual ao de criar).
            // Isso pode gerar conflito. O ideal seria usar ids unicos. 
            // Vou usar o seletor genérico do modal para tentar pegar o correto:
            if (inputDisc) disciplina = inputDisc.value;
        }

        // 3. Captura o Status
        const divStatus = document.getElementById('div_status_editar');
        const statusTexto = divStatus.getAttribute('data-status') || 'liberado';
        const ativo = (statusTexto === 'liberado') ? 1 : 0;

        const corpo = {
            nome: nome,
            email: email,
            turma: nomeTurma,
            disciplina: disciplina,
            ativo: ativo
        };

        let url;
        if (tipo === 'Aluno') {
            url = `/usuarios/editarAluno/${id}`;
        } else {
            url = `/usuarios/editarUsuario/${id}`;
        }

        fetch(url, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(corpo)
        }).then(function (resposta) {
            if (resposta.ok) {
                alert("Editado com sucesso!");
                listarUsuariosInstituicao();
                fecharModal('modal_editar_usuario');
            } else {
                resposta.text().then(texto => {
                    alert("Erro ao editar: " + texto);
                });
            }
        }).catch(function (erro) {
            console.error("Erro no fetch:", erro);
        });
    }


    function definirVisitante(id, nome, email, tipo, turma, curso, instituicao, situacao) {
        sessionStorage.setItem('idVisitante', id);
        sessionStorage.setItem('tipoVisitante', tipo);
        sessionStorage.setItem('nomeVisitante', nome);
        sessionStorage.setItem('emailVisitante', email);
        sessionStorage.setItem('turmaVisitante', turma);
        sessionStorage.setItem('cursoVisitante', curso);
        sessionStorage.setItem('instituicaoVisitante', instituicao);
        sessionStorage.setItem('situacaoVisitante', situacao);
    }

    function removerAluno(id) {
        fetch(`/usuarios/removerAluno/${id}`, {
            method: 'DELETE'
        })
            .then(response => {
                if (response.ok) {
                    listarUsuariosInstituicao();
                    fecharModal('modal_remover_usuario')
                    // Atualiza a lista de usuários
                } else {
                    alert('Erro ao remover aluno.');
                    console.error('Erro ao remover aluno:', response.statusText);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                console.error('Erro ao remover aluno:', error);
                alert('Erro ao remover aluno.');
            });
    }


    function removerUsuario(id) {
        fetch(`/usuarios/removerUsuario/${id}`, {
            method: 'DELETE'
        })
            .then(response => {
                if (response.ok) {
                    listarUsuariosInstituicao();
                    fecharModal('modal_remover_usuario')
                    // Atualiza a lista de usuários
                } else {
                    alert('Erro ao remover usuário.');
                    console.error('Erro ao remover usuário:', response.statusText);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                console.error('Erro ao remover usuário:', error);
                alert('Erro ao remover usuário.');
            });
    }

    function criarAluno(idForm) {
        sessionStorage.setItem('tipoVisitante', 'Aluno');

        const btn_criar_aluno = document.getElementById('btn_criar_aluno');
        const btn_criar_professor = document.getElementById('btn_criar_professor');

        // Visual dos botões
        if (btn_criar_aluno) btn_criar_aluno.classList.add('active');
        if (btn_criar_professor) btn_criar_professor.classList.remove('active');

        const form = document.getElementById(idForm);

        // AQUI ESTÃO OS IDS CORRETOS:
        form.innerHTML = `
          <h3>Complete as informações do Novo Aluno:</h3>
            <form class="form_modal">

                <label>RA:</label>
                <input type="text" class="input_modal" id="input_ra_aluno" placeholder="Digite o RA do aluno">

                <label>Nome:</label>
                <input type="text" class="input_modal" id="input_nome_aluno" placeholder="Digite o nome do aluno">

                <label>Email:</label>
                <input type="text" class="input_modal" id="input_email_aluno" placeholder="Digite o email do aluno">

                <label>Turma:</label>
                <input list="lista_turmas_criar" type="text" id="input_turma_aluno" class="input_modal"
                    placeholder="Pesquise pela sua turma">
                <datalist id="lista_turmas_criar" class="turmas_datalist"></datalist>

            </form>

            <div class="div_footer">
                <div class="div_criar_usuario" onclick="enviarModal('modal_criar_usuario')">
                    <p><strong>Criar Novo Usuário</strong></p>
                </div>
                <p onclick="fecharModal('modal_criar_usuario')"><u>cancelar</u></p>
            </div>

    `;

        // Carrega as listas necessárias
        listarInstituicoes();
        listarTurmas();
    }

    function criarProfessor(idForm) {

        sessionStorage.setItem('tipoVisitante', 'Professor');

        const btn_criar_aluno = document.getElementById('btn_criar_aluno')

        const btn_criar_professor = document.getElementById('btn_criar_professor')

        btn_criar_aluno.classList.toggle('active')

        btn_criar_professor.classList.toggle('active')

        form = document.getElementById(idForm)

        form.innerHTML = `

        <h3>Complete as informações do Novo Professor:</h3>
            <form class="form_modal" id="form_criar_usuario">
        
        <label for="nome">Nome:</label>
    <input type="text" class="input_modal" id="nome_prof" name="nome" placeholder="Nome do Professor">

    <label for="email">Email:</label>
    <input type="email" class="input_modal" id="email_prof" name="email" placeholder="Email do Professor">

    <label for="senha">Senha:</label>
    <input type="password" class="input_modal" id="senha_prof" name="senha" placeholder="******">

    <label for="nome_turma">Turma:</label>
    <input list="lista_turmas_prof" type="text" id="input_turma_prof" name="nome_turma" 
           placeholder="Para qual turma ele dará aula?">
    <datalist id="lista_turmas_prof" class="turmas_datalist">
        </datalist>

    <label for="nome_disciplina">Disciplina:</label>
    <input list="lista_disciplinas" type="text" id="input_disciplina_prof" name="nome_disciplina" 
           placeholder="Qual matéria? (Ex: Banco de Dados)">
    <datalist id="lista_disciplinas">
        </datalist>

        </form>

        <div class="div_footer">

                <div class="div_criar_usuario" id="btnEnviarDialog" onclick="enviarModal('modal_criar_usuario')">
                    <p><strong>Criar Novo Usuário</strong></p>
                </div>

                <p id="btnFecharDialog" onclick="fecharModal('modal_criar_usuario')"><u>cancelar</u></p>

            </div>
        `

        listarInstituicoes()
        listarTurmas()
        listarDisciplinas()

    }




</script>